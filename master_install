#!/bin/bash

DIRWAY=$(dirname $(readlink -f ${BASH_SOURCE[0]}) )

apt update
apt -y upgrade
apt install puppet puppetmaster
echo "
127.0.0.1 localhost
127.0.1.1 $hostname
#192.168.122.174 client
" >> /etc/hosts

while ! ls /var/lib/puppet/ssl/ca/requests/client.pem > /dev/null; do
echo "stay waiting a key"
sleep 30
done
echo "okay, we have a cert so we can continue"

puppet cert sign client

. $DIRWAY/createmanifest


